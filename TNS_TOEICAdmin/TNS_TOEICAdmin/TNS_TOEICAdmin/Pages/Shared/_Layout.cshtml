<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>TNS - Education</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta content="App for Bank" name="description" />
    <meta content="Themesbrand" name="TN Solution" />
    <link rel="shortcut icon" href="~/images/favicon.ico">
    <link href="~/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/lib/minible/css/icons.min.css" rel="stylesheet" type="text/css" />
    <link href="~/lib/minible/css/app.min.css" id="app-style" rel="stylesheet" type="text/css" />
    <link href="~/css/site.css" rel="stylesheet" />

</head>
<body style="background-color: #f8f9fa">
    <div id="layout-wrapper">
        <header id="page-topbar">
            <div class="navbar-header">
                <div class="d-flex align-items-center">
                    <!-- LOGO -->
                    <div class="navbar-brand-box">
                        <a href="~/Index" class="logo logo-dark">
                            <span class="logo-sm">
                                <img src="~/images/logo-sm.png" alt="Small Dark Logo" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="~/images/logo-dark.png" alt="Large Dark Logo" height="20">
                            </span>
                        </a>
                        <a href="~/Index" class="logo logo-light">
                            <span class="logo-sm">
                                <img src="~/images/logo-sm.png" alt="Small Light Logo" height="22">
                            </span>
                            <span class="logo-lg">
                                <img src="~/images/logo-light.png" alt="Large Light Logo" height="20">
                            </span>
                        </a>
                    </div>
                    <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect vertical-menu-btn">
                        <i class="fa fa-fw fa-bars"></i>
                    </button>
                </div>
                <div class="d-flex align-items-center">
                    <!-- Notification Dropdown -->
                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item noti-icon waves-effect"
                                id="page-header-notifications-dropdown"
                                data-bs-toggle="dropdown"
                                aria-expanded="false">
                            <i class="uil-bell"></i>
                            <span class="badge bg-danger rounded-pill" id="txtAmountNoticeNotRead">0</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-lg dropdown-menu-end p-0"
                            aria-labelledby="page-header-notifications-dropdown">
                            <li class="p-3">
                                <h5 class="m-0 font-size-16">Notifications</h5>
                            </li>
                            <li>
                                <div data-simplebar style="max-height: 230px;">
                                    <a href="#" class="dropdown-item text-dark notification-item d-flex align-items-start p-2">
                                        <div class="flex-shrink-0 me-3">
                                            <span class="avatar-title bg-primary rounded-circle font-size-16">
                                                <i class="uil-shopping-basket"></i>
                                            </span>
                                        </div>
                                        <div class="flex-grow-1">
                                            <h6 class="mt-0 mb-1">New Notification</h6>
                                            <p class="mb-0">This is a sample notification.</p>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="p-2 border-top">
                                <a class="dropdown-item btn btn-sm btn-link font-size-14 text-center" href="#">
                                    <i class="uil-arrow-circle-right me-1"></i> View More
                                </a>
                            </li>
                        </ul>
                    </div>

                    <!-- User Dropdown -->
                    <div class="dropdown d-inline-block">
                        <button type="button" class="btn header-item waves-effect"
                                id="page-header-user-dropdown"
                                data-bs-toggle="dropdown"
                                aria-expanded="false">
                            <img id="imgEmployeeAvatar" class="rounded-circle header-profile-user"
                                 src="~/images/avatar/default-avatar.jpg"
                                 alt="User Avatar" />
                            <span id="txtEmployeeName" class="d-none d-xl-inline-block ms-1 fw-medium font-size-15">User</span>
                            <i class="uil-angle-down d-none d-xl-inline-block font-size-15"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end"
                            aria-labelledby="page-header-user-dropdown">
                            <li>
                                <a class="dropdown-item" href="~/Employee/Profile">
                                    <i class="uil uil-user-circle font-size-18 align-middle text-muted me-1"></i>
                                    View Profile
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">
                                    <i class="uil uil-cog font-size-18 align-middle text-muted me-1"></i>
                                    Settings
                                    <span class="badge bg-success-subtle text-success rounded-pill ms-2">03</span>
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="#">
                                    <i class="uil uil-lock-alt font-size-18 align-middle text-muted me-1"></i>
                                    Lock Screen
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="~/Account/SignedOut">
                                    <i class="uil uil-sign-out-alt font-size-18 align-middle text-muted me-1"></i>
                                    Sign Out
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </header>

        <!-- Sidebar -->
        <div class="vertical-menu">
            <div class="navbar-brand-box">
                <a href="~/Index" class="logo logo-dark">
                    <span class="logo-sm">
                        <img src="~/images/logo-sm.png" alt="Small Dark Logo" height="32">
                    </span>
                    <span class="logo-lg">
                        <img src="~/images/logo-dark.png" alt="Large Dark Logo" height="30">
                    </span>
                </a>
                <a href="~/Index" class="logo logo-light">
                    <span class="logo-sm">
                        <img src="~/images/logo-sm.png" alt="Small Light Logo" height="32">
                    </span>
                    <span class="logo-lg">
                        <img src="~/images/logo-light.png" alt="Large Light Logo" height="30">
                    </span>
                </a>
            </div>
            <button type="button" class="btn btn-sm px-3 font-size-16 header-item waves-effect vertical-menu-btn">
                <i class="fa fa-fw fa-bars"></i>
            </button>
            <div data-simplebar class="sidebar-menu-scroll">
                <div id="sidebar-menu">
                    <ul class="metismenu list-unstyled" id="side-menu">
                        <li>
                            <a href="#" class="has-arrow waves-effect" style="text-decoration: none;">
                                <i class="uil-notebooks"></i>
                                <span>DATA TOEIC</span>
                            </a>
                            <ul class="sub-menu" aria-expanded="false">
                                <li><a href="/TOEICPart1/QuestionList" style="text-decoration: none;">Part 1</a></li>
                                <li><a href="/TOEICPart2/QuestionList" style="text-decoration: none;">Part 2</a></li>
                                <li><a href="/TOEICPart3/QuestionList" style="text-decoration: none;">Part 3</a></li>
                                <li><a href="/TOEICPart4/QuestionList" style="text-decoration: none;">Part 4</a></li>
                                <li><a href="/TOEICPart5/QuestionList" style="text-decoration: none;">Part 5</a></li>
                                <li><a href="/TOEICPart6/QuestionList" style="text-decoration: none;">Part 6</a></li>
                                <li><a href="/TOEICPart7/QuestionList" style="text-decoration: none;">Part 7</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#" class="has-arrow waves-effect" style="text-decoration: none;">
                                <i class="uil-book-alt"></i>
                                <span>TEACHERS</span>
                            </a>
                            <ul class="sub-menu" aria-expanded="false">
                                <li><a href="~/Employee/EmployeeList" style="text-decoration: none;">Employee List</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="#" class="has-arrow waves-effect" style="text-decoration: none;">
                                <i class="uil-book-alt"></i>
                                <span>STUDENTS</span>
                            </a>
                            <ul class="sub-menu" aria-expanded="false">
                                <li><a href="~/Employee/EmployeeList" style="text-decoration: none;">Student List</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="~/Guide/Index" style="text-decoration: none;">
                                <i class="uil-youtube"></i>
                                <span>GUIDE</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="page-content">
                <div class="container-fluid">
                    @RenderBody()
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <!-- Load local jQuery first -->
    <script src="~/lib/jquery/jquery.min.js"></script>
    <!-- Load Bootstrap (includes Popper.js) -->
    <script src="~/lib/bootstrap/js/bootstrap.bundle.min.js"></script>
    <!-- Load MetisMenu -->
    <script src="~/lib/metismenu/metisMenu.min.js"></script>
    <!-- Load DataTables -->
    <script src="~/lib/datatables/js/dataTables.min.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Check if jQuery is loaded before proceeding
            if (typeof jQuery === 'undefined') {
                console.error('jQuery is not loaded. Check the file ~/lib/jquery/jquery.min.js.');
                alert('jQuery could not be loaded. Please ensure the file exists in ~/lib/jquery/.');
            } else {
                initializeScripts();
            }

            function initializeScripts() {
                // Function to load user data dynamically after login
                function loadUserData() {
                    $.ajax({
                        url: "/Reports/Personal",
                        type: "GET",
                        success: function (data) {
                            if (data && data.EmployeeName) {
                                $("#txtAmountNoticeNotRead").text(data.NoticeNotRead || 0);
                                let avatarUrl = data.EmployeeAvatar || "~/images/avatar/default-avatar.jpg";
                                // Ensure the path starts with '/' if it's a relative path
                                if (avatarUrl && !avatarUrl.startsWith('http') && !avatarUrl.startsWith('/')) {
                                    avatarUrl = `/images/avatar/${avatarUrl}`;
                                }
                                $("#imgEmployeeAvatar").attr("src", avatarUrl);
                                $("#txtEmployeeName").text(data.EmployeeName || "User");
                            } else {
                                console.warn("No user data returned from /Reports/Personal");
                                $("#txtEmployeeName").text("User");
                                $("#imgEmployeeAvatar").attr("src", "~/images/avatar/default-avatar.jpg");
                            }
                        },
                        error: function (xhr) {
                            console.error("Error fetching user data:", xhr.responseText);
                            alert("Error loading user data: " + xhr.responseText);
                            $("#txtEmployeeName").text("User");
                            $("#imgEmployeeAvatar").attr("src", "~/images/avatar/default-avatar.jpg");
                        }
                    });
                }

                // Call loadUserData on page load
                loadUserData();

                // Refresh user data periodically (optional)
                function CallRefresh() {
                    loadUserData();
                }

                // Manually initialize Bootstrap dropdowns
                var dropdownToggles = document.querySelectorAll('[data-bs-toggle="dropdown"]');
                dropdownToggles.forEach(function (toggle) {
                    try {
                        new bootstrap.Dropdown(toggle);
                    } catch (e) {
                        console.error("Error initializing dropdown:", e);
                    }
                });

                // Initialize DataTables globally (if needed)
                if ($.fn.DataTable) {
                    $('table.dataTable').DataTable({
                        // Configuration options here
                    });
                }
            }
        });
    </script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
<style>
    .badge {
        min-width: 20px;
        height: 20px;
        line-height: 20px;
        text-align: center;
    }
</style>