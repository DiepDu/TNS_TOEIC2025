@page
@model TNS_TOEICPart3.Areas.TOEICPart3.Pages.AnswerListModel
@{
    Layout = "_Layout";
}

<style>
    .tns-field-name {
        width: 140px;
    }

    .centered-cell {
        text-align: center;
        vertical-align: middle;
    }
</style>
<link href="~/lib/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
<link href="~/lib/datatables/css/dataTables.min.css" rel="stylesheet" type="text/css" />

<div style="width:100%; margin:-20px 0 0 -20px">
    <div style="padding:5px; font-weight:bold; font-size:13px">
        <a href="~/Index" style="text-decoration:none; color:#4c4c4c">Home</a>
        <span class="uil-angle-double-right"></span>
        <a href="/TOEICPart1/QuestionList" style="text-decoration:none; color:#4c4c4c">TOEIC</a>
        <span class="uil-angle-double-right"></span>
        <a href="/TOEICPart1/QuestionList" style="text-decoration:none; color:#4c4c4c">PART 2</a>
        <span class="uil-angle-double-right"></span>
        <span style="color:maroon">Answer</span>
    </div>
</div>

<div class="row mb-2">
    <div class="col-md-10">
        <div class="col-12 text-center text-primary" style="font-size:26px; font-weight:bold">
        </div>
        <div style="color:maroon; font-weight:bold; padding-left:10px">
            <div id="Info_View"></div>
        </div>
    </div>
    <div class="col-md-2 text-end">
        <button type="button" id="btnAdd" class="btn btn-success" onclick="AddRecord_Click()">Add New</button>
    </div>
</div>

<div class="row">
    <table id="LV_Datatable" class="table table-striped table-bordered" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
        <thead>
            <tr>
                <th class="text-center align-middle text-light bg-primary" style="width:80px">No</th>
                <th class="text-center align-middle text-light bg-primary">Answer</th>
                <th class="text-center align-middle text-light bg-primary" style="width:90px">Correct</th>
            </tr>
        </thead>
        <tbody id="LV_DataBody"></tbody>
    </table>
    <div id="LV_Waiting" style="display:none">
        <div class="text-center">
            <div class="spinner-border text-primary m-5" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>
</div>

<div style="display:none">
    <div id="QuestionKey">@Model.QuestionKey</div>
</div>

<div>
    <div style="cursor:pointer" onclick="Log_Show()">
        <i class="uil-apple"></i>
    </div>
    <div id="Log_ViewData" class="row" style="display:none; padding:20px;"></div>
</div>

@section Scripts {
    <script>
        $(document).ready(function () {
            LV_LoadData_Ajax();
        });

        function Log_Show() {
            $("#Log_ViewData").css("display", "");
        }

        var _DataView;

        function LV_LoadData_Ajax() {
            $("#LV_Waiting").css("display", "");
            var zQuestionKey = $("#QuestionKey").text();
            var zDataRequest = { "QuestionKey": zQuestionKey };

            $.ajax({
                type: 'POST',
                url: "/TOEICPart3/AnswerList?handler=LoadData",
                data: JSON.stringify(zDataRequest),
                contentType: "application/json",
                dataType: "json",
            })
                .done(function (dataResponse) {
                    $("#Log_ViewData").html(JSON.stringify(dataResponse));
                    _DataView = dataResponse;
                    LV_DisplayData();
                    $("#LV_Waiting").css("display", "none");
                    $("#Info_View").html("Total: " + dataResponse.length + " answers");
                })
                .fail(function (error) {
                    alert('Error: ' + error.responseText);
                });
        }

        function LV_DisplayData() {
            var zContent = "";
            var n = _DataView ? _DataView.length : 0;
            var zNo = 1;
            for (var i = 0; i < n; i++) {
                zContent += "<tr onclick='EditRecord(\"" + _DataView[i].AnswerKey + "\")' style='cursor:pointer'>";
                zContent += "<td class='centered-cell'>" + zNo + "</td>";
                zContent += "<td class='centered-cell'>" + _DataView[i].AnswerText + "</td>";
                zContent += "<td class='centered-cell'><img src='/images/" + (_DataView[i].AnswerCorrect ? "true" : "false") + ".png' width='26px' /></td>";
                zContent += "</tr>";
                zNo++;
            }
            $("#LV_DataBody").html(zContent);
        }

        function EditRecord(answerKey) {
            var zUrl = "/TOEICPart3/Answer?Key=" + answerKey + "&QuestionKey=" + $("#QuestionKey").text();
            window.location = zUrl;
        }

        function AddRecord_Click() {
            var zQuestionKey = $("#QuestionKey").text();
            var zUrl = "/TOEICPart3/Answer?QuestionKey=" + zQuestionKey;
            window.location = zUrl;
        }
    </script>
}
